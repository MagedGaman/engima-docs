extends Node2D

# Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (0 = Level1)
var current_level = 0

# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù€40
var levels = []

func _ready():
    # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ§Øª ÙˆØ§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©)
    for i in range(1, 41):
        var lvl = {
            "name": "Level" + str(i),
            "correct_button": "Button" + str((i % 3) + 1), # Ù…Ø«Ø§Ù„ Ù„Ø£Ø²Ø±Ø§Ø± ØµØ­ÙŠØ­Ø© Ù…ØªØºÙŠØ±Ø©
            "bg_music": "res://Assets/bg" + str((i % 3)+1) + ".ogg",
            "laugh_sound": "res://Assets/laugh.ogg",
            "comment": "Ù‡Ù‡Ù‡Ù‡ ØºÙ„Ø·! Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© ğŸ˜‚"
        }
        if i == 1:
            lvl["presenter_audio"] = "res://Assets/presenter.ogg"
        levels.append(lvl)
    
    load_level(current_level)

# ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ù…Ø±Ø­Ù„Ø©
func load_level(index):
    var level = levels[index]
    
    # ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù…Ø«Ø§Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠ)
    $Background.texture = load("res://Assets/" + level["name"] + "_bg.png")
    
    # ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
    $BackgroundMusic.stream = load(level["bg_music"])
    $BackgroundMusic.play()
    
    # Ø¥Ø°Ø§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ Ø´ØºÙ„ ØµÙˆØª Ø§Ù„Ù…Ù‚Ø¯Ù…
    if index == 0 and "presenter_audio" in level:
        $PresenterAudio.stream = load(level["presenter_audio"])
        $PresenterAudio.play()
    
    # Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    for btn in $Buttons.get_children():
        btn.connect("pressed", Callable(self, "_on_Button_pressed"), [btn.name])
    
    # Ù…Ø³Ø­ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    $Label.text = ""

# Ø¹Ù†Ø¯ Ø¶ØºØ· Ø£ÙŠ Ø²Ø±
func _on_Button_pressed(button_name):
    var level = levels[current_level]
    
    if button_name == level["correct_button"]:
        # ØµØ­ â†’ Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        current_level += 1
        if current_level < levels.size():
            load_level(current_level)
        else:
            get_tree().change_scene("res://WinScreen.tscn")
    else:
        # Ø®Ø·Ø£ â†’ Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ ÙˆØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¶Ø­Ùƒ
        $Label.text = level["comment"]
        $LaughAudio.stream = load(level["laugh_sound"])
        $LaughAudio.play()
