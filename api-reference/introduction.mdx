---
title: "API Reference"
description: "Complete reference for all Enigma REST API endpoints"
---

## Base URL

```
https://connect.enigma.click
```

## Authentication

All endpoints (except monitoring) require API key authentication:

```
Authorization: Bearer YOUR_API_KEY
```

Get your API key at [enigma.click/settings](https://enigma.click/settings)

---

## Rate Limits

| Endpoint | Limit | Window |
|----------|-------|--------|
| `POST /start/start-session` | 10 requests | per minute per user |
| `POST /start/send-message` | 10 requests | per minute per user |
| `POST /start/run-task` | 10 requests | per minute per user |
| `GET /task/:sessionId/:taskId` | No limit | - |
| `GET /start/health` | No limit | - |
| `GET /start/active-sockets` | No limit | - |

Rate limits are per user (API key owner), not per API key.

---

## Endpoints

### POST /start/start-session

Create a new persistent session that can run multiple tasks.

**Request:**
```json
{
  "taskDetails": "Go to amazon.com",
  "maxDuration": 300000,
  "maxInputTokens": 100000,
  "maxOutputTokens": 100000,
  "startingUrl": "https://amazon.com",
  "avoidDomains": ["facebook.com"],
  "mode": "default",
  "terminateOnCompletion": false
}
```

**Parameters:**

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `taskDetails` | string | No | "" | Initial task description |
| `maxDuration` | number | No | 300000 | Session timeout in ms (max: 300000) |
| `maxInputTokens` | number | No | 100000 | Max input tokens for AI |
| `maxOutputTokens` | number | No | 100000 | Max output tokens for AI |
| `startingUrl` | string | No | null | Starting URL |
| `avoidDomains` | string[] | No | [] | Domains to avoid |
| `mode` | string | No | "default" | Session mode |
| `terminateOnCompletion` | boolean | No | false | Auto-terminate session after first task completes (saves costs) |

**Response (200 OK):**
```json
{
  "success": true,
  "sessionId": "a1b2c3d4e5f6",
  "socketURL": "https://connect.enigma.click",
  "streaming": {
    "webRTCURL": "https://74.235.190.31:8889/a1b2c3d4e5f6/whep",
    "webViewURL": "https://74.235.190.31:8889/a1b2c3d4e5f6",
    "dimensions": { "width": 1024, "height": 600 }
  },
  "initialPrompt": "Go to amazon.com",
  "expiresIn": 300000,
  "balance": 12.50,
  "message": "Connect to instance using sessionId in auth"
}
```

**Error Responses:**

```json
// 401 - Missing API key
{ "success": false, "message": "API key required. Provide Authorization: Bearer <api_key>" }

// 401 - Invalid API key
{ "success": false, "message": "Invalid or revoked API key" }

// 402 - Insufficient balance
{ "success": false, "message": "Insufficient balance.", "balance": 0.15 }

// 403 - Account deactivated
{ "success": false, "message": "Account is deactivated" }

// 429 - Rate limit
{ "success": false, "message": "Rate limit exceeded. Please try again later." }

// 503 - No instances
{ "success": false, "message": "No available instances." }
```

---

### POST /start/send-message

Universal endpoint for all session control commands. Handles tasks, state changes, interactions, and guardrails.

**Request:**
```json
{
  "sessionId": "a1b2c3d4e5f6",
  "message": {
    "actionType": "newTask | state | interaction | guardrail",
    // ... action-specific fields
  }
}
```

**Action Types:**

#### newTask
Start a new task. Returns taskId for polling.

```json
{
  "sessionId": "a1b2c3d4e5f6",
  "message": {
    "actionType": "newTask",
    "newState": "start",
    "taskDetails": "Search for laptops",
    "maxDuration": 60000,
    "maxInputTokens": 50000,
    "maxOutputTokens": 50000,
    "startingUrl": "https://amazon.com",
    "avoidDomains": ["facebook.com"],
    "terminateOnCompletion": true
  }
}
```

<Tip>
**ðŸ’¡ Cost Optimization:** Set `terminateOnCompletion: true` on your last task to automatically close the session and prevent idle charges.
</Tip>

**Response (completed within 50 seconds):**
```json
{
  "success": true,
  "sessionId": "a1b2c3d4e5f6",
  "taskId": "x9y8z7w6v5u4",
  "result": {
    "type": "task_completed",
    "data": {
      "message": "Found 50 laptop results",
      "prompt_tokens": 8500,
      "completion_tokens": 2300,
      "total_tokens": 10800
    }
  }
}
```

**Response (still running):**
```json
{
  "success": true,
  "sessionId": "a1b2c3d4e5f6",
  "taskId": "x9y8z7w6v5u4",
  "pending": true,
  "pollUrl": "https://connect.enigma.click/task/a1b2c3d4e5f6/x9y8z7w6v5u4",
  "message": "Task still running. Poll GET /task/:sessionId/:taskId for result."
}
```

#### state
Control task execution. Returns immediate success.

```json
{
  "sessionId": "a1b2c3d4e5f6",
  "message": {
    "actionType": "state",
    "newState": "pause | resume | stop | terminate"
  }
}
```

**Response:**
```json
{
  "success": true,
  "message": "Message sent successfully"
}
```

#### interaction
Manual browser control. Returns immediate success.

```json
{
  "sessionId": "a1b2c3d4e5f6",
  "message": {
    "actionType": "interaction",
    "action": {
      "type": "CLICK | TYPE | KEY_PRESS | takeOverControl | releaseControl",
      // ... action-specific params
    }
  }
}
```

**Response:**
```json
{
  "success": true,
  "message": "Message sent successfully"
}
```

#### guardrail
Respond to guardrail trigger. Returns immediate success.

```json
{
  "sessionId": "a1b2c3d4e5f6",
  "message": {
    "actionType": "guardrail",
    "taskDetails": "Username: user@example.com, Password: pass123",
    "newState": "resume"
  }
}
```

**Response:**
```json
{
  "success": true,
  "message": "Message sent successfully"
}
```

**Error Responses:**

```json
// 400 - Missing fields
{ "success": false, "message": "sessionId and message are required" }

// 401 - Invalid session
{ "success": false, "message": "Session not found or unauthorized" }
```

---

### POST /start/run-task

Execute a single task with auto-terminating session. Simplified version of start-session + send-message.

**Request:**
```json
{
  "taskDetails": "Search Google for Anthropic",
  "maxDuration": 300000,
  "maxInputTokens": 100000,
  "maxOutputTokens": 100000,
  "startingUrl": "https://google.com",
  "avoidDomains": [],
  "mode": "default"
}
```

**Parameters:**

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `taskDetails` | string | **Yes** | - | Task description |
| `maxDuration` | number | No | 300000 | Session timeout in ms |
| `maxInputTokens` | number | No | 100000 | Max input tokens |
| `maxOutputTokens` | number | No | 100000 | Max output tokens |
| `startingUrl` | string | No | null | Starting URL |
| `avoidDomains` | string[] | No | [] | Domains to avoid |
| `mode` | string | No | "default" | Session mode |

<Note>
`terminateOnCompletion` is automatically set to `true` for this endpoint. The session will close after task completion.
</Note>

**Response (completed within 50 seconds):**
```json
{
  "success": true,
  "sessionId": "a1b2c3d4e5f6",
  "taskId": "x9y8z7w6v5u4",
  "status": "complete",
  "result": {
    "type": "task_completed",
    "data": {
      "message": "Successfully searched for Anthropic",
      "prompt_tokens": 12450,
      "completion_tokens": 3200,
      "total_tokens": 15650,
      "completion_time": 23.5
    }
  }
}
```

**Response (still running):**
```json
{
  "success": true,
  "sessionId": "a1b2c3d4e5f6",
  "taskId": "x9y8z7w6v5u4",
  "status": "pending",
  "pollUrl": "https://connect.enigma.click/task/a1b2c3d4e5f6/x9y8z7w6v5u4",
  "message": "Task still running. Poll GET /task/:sessionId/:taskId for result."
}
```

**Error Responses:**

```json
// 400 - Missing task details
{ "success": false, "message": "taskDetails is required" }

// 402 - Insufficient balance
{ "success": false, "message": "Insufficient balance.", "balance": 0.15 }

// 503 - No instances
{ "success": false, "message": "No available instances." }
```

---

### GET /task/:sessionId/:taskId

Poll for task result. No rate limit.

**Response (still running):**
```json
{
  "success": true,
  "status": "active",
  "pending": true,
  "usage": {
    "inputTokens": 8000,
    "outputTokens": 2100,
    "computeTime": 3,
    "cost": 0.0067
  }
}
```

**Response (completed):**
```json
{
  "success": true,
  "type": "task_completed",
  "data": {
    "message": "Task finished successfully",
    "prompt_tokens": 12450,
    "completion_tokens": 3200,
    "total_tokens": 15650,
    "completion_time": 23.5
  },
  "usage": {
    "inputTokens": 12450,
    "outputTokens": 3200,
    "computeTime": 5,
    "cost": 0.0124
  },
  "completedAt": "2024-01-15T10:30:00Z"
}
```

**Response (guardrail triggered):**
```json
{
  "success": true,
  "type": "guardrail_trigger",
  "data": {
    "type": "human_input_needed",
    "value": "I need login credentials to proceed"
  }
}
```

**Response (failed):**
```json
{
  "success": false,
  "status": "failed",
  "error": "Navigation timeout after 30 seconds",
  "usage": {
    "inputTokens": 5000,
    "outputTokens": 1200,
    "computeTime": 2,
    "cost": 0.0045
  }
}
```

**Error Responses:**

```json
// 404 - Task not found
{ "success": false, "message": "Session not found" }
```

---

### GET /start/health

System health check. No authentication required.

**Response:**
```json
{
  "success": true,
  "status": "healthy",
  "instancesAvailable": true,
  "instanceCount": 5,
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

---

### GET /start/active-sockets

View active instance connections. No authentication required.

**Response:**
```json
{
  "success": true,
  "sockets": ["socket_id_1", "socket_id_2", "socket_id_3"],
  "count": 3,
  "timestamp": "2024-01-15T10:30:00.000Z"
}
```

---

## Complete Examples

### Example 1: Simple task execution

```javascript
const response = await fetch("https://connect.enigma.click/start/run-task", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Authorization": "Bearer enig_xxxxxxxxxxxx"
  },
  body: JSON.stringify({
    taskDetails: "Search Google for Anthropic"
  })
});

const data = await response.json();

if (data.status === "complete") {
  console.log("Result:", data.result);
} else if (data.pending) {
  // Poll for result
  const pollUrl = data.pollUrl;
  // ... polling logic
}
```

### Example 2: Multi-task session

```javascript
// 1. Create session
const session = await fetch("https://connect.enigma.click/start/start-session", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Authorization": "Bearer enig_xxxxxxxxxxxx"
  },
  body: JSON.stringify({
    taskDetails: "Go to amazon.com",
    startingUrl: "https://amazon.com"
  })
}).then(r => r.json());

const sessionId = session.sessionId;

// 2. Send follow-up task
const task = await fetch("https://connect.enigma.click/start/send-message", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Authorization": "Bearer enig_xxxxxxxxxxxx"
  },
  body: JSON.stringify({
    sessionId,
    message: {
      actionType: "newTask",
      newState: "start",
      taskDetails: "Search for wireless keyboards"
    }
  })
}).then(r => r.json());

// 3. Poll if needed
if (task.pending) {
  // ... polling logic
}

// 4. Pause execution
await fetch("https://connect.enigma.click/start/send-message", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Authorization": "Bearer enig_xxxxxxxxxxxx"
  },
  body: JSON.stringify({
    sessionId,
    message: { actionType: "state", newState: "pause" }
  })
});

// 5. Resume
await fetch("https://connect.enigma.click/start/send-message", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Authorization": "Bearer enig_xxxxxxxxxxxx"
  },
  body: JSON.stringify({
    sessionId,
    message: { actionType: "state", newState: "resume" }
  })
});

// 6. Terminate
await fetch("https://connect.enigma.click/start/send-message", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Authorization": "Bearer enig_xxxxxxxxxxxx"
  },
  body: JSON.stringify({
    sessionId,
    message: { actionType: "state", newState: "terminate" }
  })
});
```

---

## Error Handling

All errors follow this format:

```json
{
  "success": false,
  "message": "Human-readable error message"
}
```

Common HTTP status codes:

| Status | Meaning |
|--------|---------|
| 200 | Success |
| 400 | Bad request (missing/invalid parameters) |
| 401 | Unauthorized (invalid API key) |
| 402 | Payment required (insufficient balance) |
| 403 | Forbidden (account deactivated or missing permissions) |
| 404 | Not found (session/task doesn't exist) |
| 429 | Too many requests (rate limit exceeded) |
| 500 | Internal server error |
| 503 | Service unavailable (no instances available) |

See [Errors & Troubleshooting](/errors) for comprehensive error handling guide.

---

## Next Steps

<CardGroup cols={2}>
  <Card title="Quickstart" icon="rocket" href="/quickstart">
    Get started in 5 minutes
  </Card>
  <Card title="Controlling Sessions" icon="gamepad" href="/control">
    Detailed command reference
  </Card>
  <Card title="Errors & Troubleshooting" icon="triangle-exclamation" href="/errors">
    Error handling guide
  </Card>
  <Card title="Sessions & Tasks" icon="browser" href="/sessions">
    Session lifecycle
  </Card>
</CardGroup>
